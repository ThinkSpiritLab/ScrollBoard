(this["webpackJsonpscroll-board"]=this["webpackJsonpscroll-board"]||[]).push([[0],{134:function(e,t,n){e.exports=n(262)},140:function(e,t,n){},255:function(e,t,n){},262:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(8),c=n.n(o);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var l=n(23),i=(n(139),n(140),n(27)),s=n.n(i),u=n(54);function d(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(e){var n,a;t(null===(n=e.target)||void 0===n||null===(a=n.result)||void 0===a?void 0:a.toString())},a.onerror=function(e){return n(e)},a.readAsText(e)}))}function m(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))}var f,p=n(132),b=s.a.mark(h);function v(e){e.teamStates.sort((function(e,t){return e.solved!==t.solved?-(e.solved-t.solved):e.penalty!==t.penalty?e.penalty-t.penalty:e.info.name!==t.info.name?e.info.name<t.info.name?-1:1:0}));var t=0,n=0,a=0;e.teamStates.forEach((function(e,r){(e.solved<t||e.penalty>n)&&(a=r+1),e.rank=a,t=e.solved,n=e.penalty}))}function h(e){var t,n;return s.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:t=!0,n=s.a.mark((function n(){var a,r,o,c,l,i,u;return s.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(e.cursor.focus=e.cursor.index,a=e.teamStates[e.cursor.index],!(r=a.problemStates.find((function(e){return e.state===f.Pending})))){n.next=28;break}if(t){n.next=8;break}return e.cursor.tick+=1,void(n.next=8);case 8:return c=r.unrevealedSubmissions.some((function(e){return e.accepted})),e.cursor.tick+=1,n.next=12,{teamId:a.info.id,problemId:r.info.id,accepted:c};case 12:return c?(r.state=f.Passed,l=r.unrevealedSubmissions.findIndex((function(e){return e.accepted})),r.tryCount=r.tryCount-r.unrevealedSubmissions.length+l+1,r.acceptTime=r.unrevealedSubmissions[l].submitTime,a.solved+=1,a.penalty+=6e4*Math.floor(r.acceptTime/6e4)+e.info.penaltyTime*(r.tryCount-1)):r.state=f.Failed,(o=r.revealedSubmissions).push.apply(o,Object(p.a)(r.unrevealedSubmissions)),r.unrevealedSubmissions=[],void(n.next=17);case 17:return i=a.rank,v(e),u=a.rank,console.log('team "'.concat(a.info.name,'" rank ').concat(i," -> ").concat(u)),e.cursor.focus=e.teamStates.findIndex((function(e){return Object.is(e,a)})),e.cursor.tick+=1,void(n.next=25);case 25:t=!0,n.next=35;break;case 28:if(t){n.next=33;break}return console.log("yield at cursor index = ",e.cursor.index),e.cursor.tick+=1,void(n.next=33);case 33:e.cursor.index-=1,t=!1;case 35:case"end":return n.stop()}}),n)}));case 2:if(!(e.cursor.index>=0)){a.next=6;break}return a.delegateYield(n(),"t0",4);case 4:a.next=2;break;case 6:e.cursor.focus=-1;case 7:case"end":return a.stop()}}),b)}!function(e){e[e.Passed=0]="Passed",e[e.Failed=1]="Failed",e[e.Pending=2]="Pending",e[e.Untouched=3]="Untouched"}(f||(f={}));var y=n(268),g=n(269),E=n(51),x=n(272),w=n(266),k=n(274),j=n(267),O=n(276),S=n(277),I=n(275),C=n(33),F=n(278),R=n(279),T=n(117);function P(){var e=T.parse(window.location.search)["data-url"];return"string"===typeof e?e:void 0}var M=function(e){var t=e.onLoad,n=e.onStart,o=Object(a.useState)(),c=Object(l.a)(o,2),i=c[0],m=c[1],f=Object(a.useRef)(null),p=Object(a.useState)(null),b=Object(l.a)(p,2),v=b[0],h=b[1],T=function(){var e=Object(u.a)(s.a.mark((function e(n){var a,r,o,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=null===(a=n.currentTarget.files)||void 0===a?void 0:a.item(0))){e.next=9;break}return e.next=4,d(r);case 4:o=e.sent,c=JSON.parse(o),m(r.name),h(c),t(c);case 9:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){(function(){var e=Object(u.a)(s.a.mark((function e(){var n,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=P())){e.next=11;break}return e.next=4,fetch(n);case 4:return a=e.sent,e.next=7,a.json();case 7:r=e.sent,m(n),h(r),t(r);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()().catch((function(e){return console.error(e)}))}),[t]);var M=y.a.useForm(),B=Object(l.a)(M,1)[0],N=Object(a.useCallback)((function(){var e=!!B.getFieldValue("autoReveal"),t=!!B.getFieldValue("shiningBeforeReveal"),a=parseFloat(B.getFieldValue("speedFactor")),r=void 0!==(null===v||void 0===v?void 0:v.medal)&&!!B.getFieldValue("showMedal");n({autoReveal:e,shiningBeforeReveal:t,speedFactor:a,showMedal:r})}),[n,B,v]);return r.a.createElement(g.a,{style:{borderColor:"transparent",boxShadow:"0 1px 2px -2px rgba(0, 0, 0, 0.16), 0 3px 6px 0 rgba(0, 0, 0, 0.12), 0 5px 12px 4px rgba(0, 0, 0, 0.09)"}},r.a.createElement("input",{type:"file",style:{display:"none"},multiple:!1,ref:f,onChange:T}),r.a.createElement(E.a,{justify:"center",style:{alignItems:"baseline"}},i?r.a.createElement("span",{style:{flexGrow:1,textAlign:"center",margin:"0 1em"}},i):null,r.a.createElement(x.a,{icon:r.a.createElement(F.a,null),onClick:function(){var e;return null===(e=f.current)||void 0===e?void 0:e.click()}},"\u52a0\u8f7d\u6570\u636e")),null===v?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(w.a,{style:{margin:"1em 0"}}),r.a.createElement(E.a,{style:{marginTop:"1em"}},r.a.createElement(k.a,{column:{xs:1,lg:3},title:r.a.createElement("span",{style:{display:"inline-block",width:"100%",textAlign:"center",fontSize:"1.5em"}},v.name)},r.a.createElement(k.a.Item,{label:"\u6bd4\u8d5b\u65f6\u957f"},v.duration/6e4," \u5206\u949f"),r.a.createElement(k.a.Item,{label:"\u5c01\u699c\u65f6\u523b"},v.freezeTime/6e4,"  \u5206\u949f"),r.a.createElement(k.a.Item,{label:"\u7f5a\u65f6\u5355\u4f4d"},v.penaltyTime/6e4," \u5206\u949f"),r.a.createElement(k.a.Item,{label:"\u9898\u76ee\u6570\u91cf"},v.problems.length),r.a.createElement(k.a.Item,{label:"\u961f\u4f0d\u6570\u91cf"},v.teams.length),r.a.createElement(k.a.Item,{label:"\u63d0\u4ea4\u6570\u91cf"},v.submissions.length),r.a.createElement(k.a.Item,{label:"\u9898\u76ee\u989c\u8272",span:3},r.a.createElement(j.a,{style:{display:"inline-flex",flexWrap:"wrap"}},v.problems.map((function(e){return r.a.createElement(O.a,{key:e.id,style:{display:"inline-flex",alignItems:"center"}},r.a.createElement("strong",{style:{marginRight:"0.5em"}},e.tag),r.a.createElement("span",{style:{display:"inline-block",width:"1em",height:"1em",backgroundColor:e.color,borderRadius:"50%"}}))})))))),r.a.createElement(E.a,null,r.a.createElement(y.a,{form:B,style:{width:"100%"},layout:"inline",initialValues:{autoReveal:!1,shiningBeforeReveal:!0,speedFactor:1,showMedal:!0}},r.a.createElement(y.a.Item,{name:"autoReveal",label:"\u81ea\u52a8\u8fd0\u884c",valuePropName:"checked"},r.a.createElement(S.a,null)),r.a.createElement(y.a.Item,{name:"shiningBeforeReveal",label:"\u9898\u76ee\u95ea\u70c1\u52a8\u753b",valuePropName:"checked"},r.a.createElement(S.a,null)),r.a.createElement(y.a.Item,{name:"speedFactor",label:"\u901f\u5ea6\u56e0\u5b50"},r.a.createElement(I.a,{min:.1,max:10,step:.1})),void 0===v.medal?null:r.a.createElement(y.a.Item,{name:"showMedal",label:"\u663e\u793a\u5956\u724c",valuePropName:"checked"},r.a.createElement(S.a,null)))),r.a.createElement(E.a,{justify:"center",style:{marginTop:"1em"}},r.a.createElement(C.a,{span:6,style:{display:"flex",justifyContent:"center"}},r.a.createElement(x.a,{icon:r.a.createElement(R.a,null),onClick:N,style:{width:"100%"}},"\u5f00\u59cb")))))},B=n(96),N=(n(255),n(130)),z=n(93),W=n(273),L=n(270),V=n(271);function A(e){return e===f.Passed?"green":e===f.Failed?"red":e===f.Pending?"orange":void 0}function H(e){L.b.info({content:e,className:"info-message",duration:.4})}var U=function(e){var t=e.data,n=e.options,o=Object(a.useState)(Object(a.useMemo)((function(){return function(e){var t=new Map;e.teams.forEach((function(n){t.set(n.id,{info:n,rank:0,solved:0,penalty:0,problemStates:e.problems.map((function(e){return{info:e,revealedSubmissions:[],unrevealedSubmissions:[],state:f.Untouched,tryCount:0,acceptTime:null}}))})})),e.submissions.sort((function(e,t){return e.submitTime-t.submitTime})),e.submissions.forEach((function(n){var a=t.get(n.teamId);if(!a)throw new Error("invalid data");var r=a.problemStates.find((function(e){return e.info.id===n.problemId}));if(!r)throw new Error("invalid data");r.state!==f.Passed&&(n.submitTime<e.freezeTime?(r.revealedSubmissions.push(n),r.tryCount+=1,n.accepted?(r.state=f.Passed,r.acceptTime=n.submitTime,a.solved+=1,a.penalty+=6e4*Math.floor(r.acceptTime/6e4)+e.penaltyTime*(r.tryCount-1)):r.state=f.Failed):(r.unrevealedSubmissions.push(n),r.tryCount+=1,r.state=f.Pending))}));var n=Array.from(t.entries()).map((function(e){return e[1]})),a={teamStates:n,info:e,cursor:{index:n.length-1,tick:0,focus:n.length-1}};return v(a),a}(t)}),[t])),c=Object(l.a)(o,2),i=c[0],d=c[1],p=Object(a.useState)(null),b=Object(l.a)(p,2),y=b[0],g=b[1],E=Object(a.useRef)(h(i)),x=Object(a.useRef)(null),w=Object(a.useState)(!1),k=Object(l.a)(w,2),j=k[0],O=k[1],S=Object(a.useState)(!1),I=Object(l.a)(S,2),C=I[0],F=I[1],R=Object(a.useState)(n.autoReveal),T=Object(l.a)(R,2),P=T[0],M=T[1],L=Object(a.useState)(n.speedFactor),U=Object(l.a)(L,2),J=U[0],q=U[1],Y=Object(a.useState)(i.cursor.focus),D=Object(l.a)(Y,2),G=D[0],Z=D[1],$=Object(a.useCallback)((function(){console.log((new Date).getTime(),"handleNextStep");var e=i.cursor.index,t=E.current.next();if(Z(i.cursor.focus),i.cursor.index!==e&&i.cursor.index>=0){var a=i.teamStates[i.cursor.index],r=document.querySelector("#team-id-".concat(a.info.id)).getBoundingClientRect();window.scrollTo({left:0,top:window.scrollY+r.top-window.innerHeight/2,behavior:"smooth"})}if(console.log("cursor index = ",i.cursor.index),t.done)g(null);else if(t.value){var o=t.value;Object(u.a)(s.a.mark((function e(){var t,a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("reveal highlight"),F(!0),console.log("locked"),g(o),t=n.shiningBeforeReveal?600:P?200:0,console.log("delay",t/J),e.next=8,m(t/J);case 8:return $(),t=P?o.accepted?500:200:0,console.log("delay",t/J),e.next=13,m(t/J);case 13:if(a=i.teamStates.find((function(e){return e.info.id===o.teamId})),r=null===a||void 0===a?void 0:a.rank,$(),c=null===a||void 0===a?void 0:a.rank,r===c){e.next=22;break}return t=800,console.log("delay",t/J),e.next=22,m(t/J);case 22:F(!1),console.log("unlocked");case 24:case"end":return e.stop()}}),e)})))()}else g(null);return d(Object(B.a)({},i)),t.done}),[i,J,n.shiningBeforeReveal,P]);Object(a.useEffect)((function(){if(0===i.cursor.tick){var e=i.teamStates[i.cursor.index];document.querySelector("#team-id-".concat(e.info.id)).scrollIntoView({behavior:"smooth"})}}),[i]);var K=Object(a.useCallback)((function(e){if(console.log("keydown",e.key),"Enter"===e.key){if(i.cursor.index<0)return;if(C)return;$()}if("p"===e.key&&(P?(console.log("disable autoReveal"),H("\u7981\u7528\u81ea\u52a8\u8fd0\u884c")):(console.log("enable autoReveal"),H("\u542f\u7528\u81ea\u52a8\u8fd0\u884c")),M((function(e){return!e}))),"+"===e.key){var t=Math.min(J+.1,10);q(t),console.log("speedFactor",t),H("\u901f\u5ea6\u56e0\u5b50\uff1a".concat(t.toFixed(1)))}if("-"===e.key){var n=Math.max(J-.1,.1);q(n),console.log("speedFactor",n),H("\u901f\u5ea6\u56e0\u5b50\uff1a".concat(n.toFixed(1)))}if("Control"===e.key){var a=J+3;a>10&&(a-=10),a<.1&&(a=.1),q(a),console.log("speedFactor",a),H("\u901f\u5ea6\u56e0\u5b50\uff1a".concat(a.toFixed(1)))}}),[$,C,J,i.cursor,P]);Object(a.useEffect)((function(){return document.addEventListener("keydown",K),function(){return document.removeEventListener("keydown",K)}}),[K]);var Q=Object(a.useCallback)((function(){i.cursor.index<0||C||(console.log("click"),$())}),[$,C,i.cursor]);Object(a.useEffect)((function(){return document.addEventListener("click",Q),function(){return document.removeEventListener("click",Q)}}),[Q]),Object(a.useEffect)((function(){if(0!==i.cursor.tick&&P&&i.cursor.index>=0){var e=setInterval((function(){C||$()&&clearInterval(e)}),500/J);return function(){return clearInterval(e)}}}),[i,C,$,P,J]),Object(a.useEffect)((function(){if(y&&n.shiningBeforeReveal){O((function(e){return!e}));var e=setInterval((function(){O((function(e){return console.log("flag",!e),!e}))}),400/J);return function(){return clearInterval(e)}}}),[y,n,J]);var X=Object(a.useState)(window.innerWidth),_=Object(l.a)(X,2),ee=_[0],te=_[1];Object(a.useEffect)((function(){return window.onresize=function(){return te(window.innerWidth)},function(){window.onresize=null}}),[]);var ne=Object(a.useCallback)((function(){Z(i.cursor.index)}),[i.cursor]);return r.a.createElement(z.StickyContainer,{style:{width:"100%"}},r.a.createElement(z.Sticky,null,(function(e){var n=e.style;return r.a.createElement("table",{className:"board-head",style:n},r.a.createElement("thead",null,r.a.createElement("tr",null,r.a.createElement("th",{style:{width:"5%"}},r.a.createElement("span",{style:{position:"absolute",zIndex:2048,top:0,left:0,borderRadius:"50%",width:"6px",height:"6px",backgroundColor:C?"#ff4d4f":"#52c41a"}}),"Rank"),r.a.createElement("th",{style:{width:"20%"}},"Team"),r.a.createElement("th",{style:{width:"10%"}},"Score"),t.problems.map((function(e){return r.a.createElement("th",{key:e.id,style:{width:"".concat(65/t.problems.length,"%")}},r.a.createElement("span",{style:{display:"inline-flex",alignItems:"center"}},r.a.createElement("strong",{style:{marginRight:"0.5em"}},e.tag),r.a.createElement("span",{style:{display:"inline-block",width:"1em",height:"1em",backgroundColor:e.color,borderRadius:"50%"}})))})))))})),r.a.createElement(N.a,{className:"board-body",duration:800/J,onFinish:ne},i.teamStates.map((function(e,t){var a=t===G,o="white";if(i.info.medal&&n.showMedal){var c=i.info.medal.gold,l=c+i.info.medal.silver,s=l+i.info.medal.bronze;t<c?o="#fff9c0":t<l?o="#f6f6f6":t<s&&(o="#eddccf")}return r.a.createElement("table",{key:e.info.id,id:"team-id-".concat(e.info.id),className:a?"focused-team":"team",style:{transformStyle:"preserve-3d"}},r.a.createElement("tbody",null,r.a.createElement("tr",{style:{transform:a?"perspective(65535px) translateZ(1px)":void 0,backgroundColor:o}},r.a.createElement("td",{style:{width:"5%"}},e.rank),r.a.createElement(V.a,{title:e.info.name},r.a.createElement("td",{style:{maxWidth:"".concat(.2*ee,"px"),width:"20%",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},e.info.name)),r.a.createElement("td",{style:{width:"10%"}},"".concat(e.solved," - ").concat(Math.floor(e.penalty/6e4))),e.problemStates.map((function(t){var n,a=y&&y.teamId===e.info.id&&y.problemId===t.info.id,o=t.state===f.Untouched?void 0:t.state===f.Passed?"".concat(t.tryCount," - ").concat(Math.floor((null!==(n=t.acceptTime)&&void 0!==n?n:0)/6e4)):"".concat(t.tryCount),c=400/J,l=function(e){return r.a.createElement("span",{style:Object(B.a)({display:"inline-block",maxWidth:"4em",width:"100%",minHeight:"1em",borderRadius:"0.25em",backgroundColor:A(t.state),color:"white",transition:"opacity ".concat(c,"ms ease-in-out"),opacity:1},e),ref:a?x:null},o)},i={entering:{opacity:0},entered:{opacity:0},exiting:{opacity:1},exited:{opacity:1},unmounted:{}},s=a?r.a.createElement(W.a,{in:j,timeout:c,nodeRef:x},(function(e){return l(i[e])})):l({});return r.a.createElement("td",{key:t.info.id,style:{width:"".concat(65/e.problemStates.length,"%")}},s)})))))}))))},J=function(){var e=Object(a.useState)(null),t=Object(l.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(null),i=Object(l.a)(c,2),s=i[0],u=i[1],d=Object(a.useState)(!1),m=Object(l.a)(d,2),f=m[0],p=m[1],b=Object(a.useCallback)((function(e){p(!0),u(e),console.debug(n,e)}),[n]),v=Object(a.useCallback)((function(e){return o(e)}),[]);return r.a.createElement(r.a.Fragment,null,f?null:r.a.createElement(E.a,{justify:"center",style:{marginTop:"0em",alignItems:"center",minHeight:"80vh"}},r.a.createElement(C.a,{span:24,lg:16},r.a.createElement(M,{onLoad:v,onStart:b}))),null!==n&&f?r.a.createElement(r.a.Fragment,null,r.a.createElement(E.a,{justify:"center",style:{width:"calc(100vw - 4px)"}},r.a.createElement(U,{data:n,options:s})),r.a.createElement("div",{style:{minHeight:"50vh"}})):null)};c.a.render(r.a.createElement(J,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[134,1,2]]]);
//# sourceMappingURL=main.fbbeb997.chunk.js.map