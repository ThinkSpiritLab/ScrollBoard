{"version":3,"sources":["serviceWorker.ts","app/util.ts","app/Loader.tsx","app/vo.ts","app/Board.tsx","app/App.tsx","index.tsx"],"names":["Boolean","window","location","hostname","match","readFile","file","Promise","resolve","reject","reader","FileReader","onload","e","target","result","toString","onerror","readAsText","delay","ms","setTimeout","getRemoteFileUrl","value","queryString","search","ProblemStateKind","Loader","onLoad","onStart","useState","fileName","setFileName","fileInputRef","useRef","data","setData","handleLoad","a","currentTarget","files","item","util","content","JSON","parse","name","useEffect","remoteFileUrl","fetch","resp","json","loadRemote","catch","err","console","error","Form","useForm","form","handleStart","useCallback","autoReveal","getFieldValue","shiningBeforeReveal","speedFactor","parseFloat","showMedal","undefined","medal","style","borderColor","boxShadow","type","display","multiple","ref","onChange","justify","alignItems","flexGrow","textAlign","margin","icon","UploadOutlined","onClick","current","click","marginTop","column","xs","lg","title","width","fontSize","Item","label","duration","freezeTime","penaltyTime","problems","length","teams","submissions","span","flexWrap","map","p","key","id","marginRight","tag","height","backgroundColor","color","borderRadius","layout","initialValues","valuePropName","min","max","step","justifyContent","PlayCircleOutlined","reveal","calcRankInplace","state","teamStates","sort","lhs","rhs","solved","penalty","info","last_solved","last_penalty","last_rank","forEach","team","idx","rank","checked","cursor","focus","index","problemStates","find","Pending","tick","isAccepted","unrevealedSubmissions","some","s","accepted","teamId","problemId","Passed","findIndex","tryCount","acceptTime","submitTime","Math","floor","Failed","revealedSubmissions","push","prevRank","curRank","log","t","Object","is","cvtColor","vo","Board","options","useMemo","teamMap","Map","contestant","set","problem","Untouched","submission","get","Error","Array","from","entries","setState","highlightItem","setHighlightItem","revealGen","highlightNodeRef","highlightFlag","setHighlightFlag","keyLock","setKeyLock","setAutoReveal","setSpeedFactor","focusIndex","setFocusIndex","handleNextStep","Date","getTime","prevCursorIdx","next","rect","document","querySelector","getBoundingClientRect","scrollTo","left","top","scrollY","innerHeight","behavior","done","scrollIntoView","handleKeydown","addEventListener","removeEventListener","handleClick","timer","setInterval","clearInterval","f","innerWidth","windowWidth","setWindowWidth","onresize","handleMovingFinished","zIndex","position","overflowAnchor","transformStyle","onFinish","isFocused","goldLine","gold","silverLine","silver","bronzeLine","bronze","className","transform","maxWidth","whiteSpace","overflow","textOverflow","isHighlighted","text","grid","minHeight","transition","opacity","transitionStyles","entering","entered","exiting","exited","unmounted","wrappedGrid","Transition","in","timeout","nodeRef","App","setOptions","running","setRunning","debug","ReactDOM","render","getElementById","navigator","serviceWorker","ready","then","registration","unregister","message"],"mappings":"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","file":"static/js/main.fe5ba927.chunk.js","sourcesContent":["// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\ntype Config = {\n  onSuccess?: (registration: ServiceWorkerRegistration) => void;\n  onUpdate?: (registration: ServiceWorkerRegistration) => void;\n};\n\nexport function register(config?: Config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(\n      process.env.PUBLIC_URL,\n      window.location.href\n    );\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl: string, config?: Config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl: string, config?: Config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' }\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","export function readFile(file: File): Promise<string> {\n    return new Promise((resolve, reject) => {\n        const reader = new FileReader();\n        reader.onload = (e: ProgressEvent<FileReader>): void => {\n            resolve(e.target?.result?.toString());\n        };\n\n        reader.onerror = ((e): void => reject(e));\n\n        reader.readAsText(file);\n    });\n}\n\nexport function delay(ms: number): Promise<void> {\n    return new Promise((resolve) => {\n        setTimeout(() => resolve(), ms);\n    });\n}","import * as dto from \"./dto\";\nimport * as util from \"./util\";\nimport * as vo from \"./vo\";\n\nimport React, { useState, useRef, useEffect, useCallback, } from \"react\";\nimport { Card, Button, Row, Divider, Descriptions, Space, Tag, Col, Form, Switch, InputNumber } from \"antd\";\nimport { UploadOutlined, PlayCircleOutlined } from \"@ant-design/icons\";\nimport * as queryString from \"query-string\";\n\nexport interface LoaderProps {\n    onLoad: (data: dto.Contest) => void;\n    onStart: (options: vo.BoardOptions) => void;\n}\n\nfunction getRemoteFileUrl(): string | undefined {\n    const value = queryString.parse(window.location.search)[\"data-url\"];\n    if (typeof value === \"string\") {\n        return value;\n    } else {\n        return undefined;\n    }\n}\n\nconst Loader: React.FC<LoaderProps> = ({ onLoad, onStart }: LoaderProps) => {\n    const [fileName, setFileName] = useState<string | null>();\n    const fileInputRef = useRef<HTMLInputElement | null>(null);\n\n    const [data, setData] = useState<dto.Contest | null>(null);\n\n    const handleLoad = async (e: React.ChangeEvent<HTMLInputElement>): Promise<void> => {\n        const file = e.currentTarget.files?.item(0);\n        if (file) {\n            const content = await util.readFile(file);\n            const data = JSON.parse(content) as unknown as dto.Contest; // FIXME: validate\n            setFileName(file.name);\n            setData(data);\n            onLoad(data);\n        }\n    };\n\n    useEffect(() => {\n        const loadRemote = async (): Promise<void> => {\n            const remoteFileUrl: string | undefined = getRemoteFileUrl();\n            if (remoteFileUrl) {\n                const resp = await fetch(remoteFileUrl);\n                const data = await resp.json() as unknown as dto.Contest; // FIXME: validate\n                setFileName(remoteFileUrl);\n                setData(data);\n                onLoad(data);\n            }\n        };\n        loadRemote().catch(err => console.error(err));\n    }, [onLoad]);\n\n    const [form] = Form.useForm();\n\n    const handleStart = useCallback(() => {\n        const autoReveal = !!form.getFieldValue(\"autoReveal\");\n        const shiningBeforeReveal = !!form.getFieldValue(\"shiningBeforeReveal\");\n        const speedFactor = parseFloat(form.getFieldValue(\"speedFactor\"));\n        const showMedal = (data?.medal !== undefined) && (!!form.getFieldValue(\"showMedal\"));\n        onStart({ autoReveal, shiningBeforeReveal, speedFactor, showMedal });\n    }, [onStart, form, data]);\n\n    return (\n        <Card\n            style={{\n                borderColor: \"transparent\",\n                boxShadow: \"0 1px 2px -2px rgba(0, 0, 0, 0.16), 0 3px 6px 0 rgba(0, 0, 0, 0.12), 0 5px 12px 4px rgba(0, 0, 0, 0.09)\",\n            }}\n        >\n            <input\n                type=\"file\"\n                style={{ display: \"none\" }}\n                multiple={false}\n                ref={fileInputRef}\n                onChange={handleLoad}\n            />\n            <Row justify=\"center\" style={{ alignItems: \"baseline\" }}>\n                {(fileName) ? (\n                    <span style={{ flexGrow: 1, textAlign: \"center\", margin: \"0 1em\" }}>\n                        {fileName}\n                    </span>\n                ) : null}\n                <Button\n                    icon={<UploadOutlined />}\n                    onClick={(): void => fileInputRef.current?.click()}\n                >\n                    加载数据\n                </Button>\n            </Row>\n            {data === null ? null : (\n                <>\n                    <Divider style={{ margin: \"1em 0\" }} />\n                    <Row style={{ marginTop: \"1em\" }}>\n                        <Descriptions\n                            column={{ xs: 1, lg: 3 }}\n                            title={\n                                <span\n                                    style={{\n                                        display: \"inline-block\",\n                                        width: \"100%\",\n                                        textAlign: \"center\",\n                                        fontSize: \"1.5em\"\n                                    }}\n                                >\n                                    {data.name}\n                                </span>\n                            }\n                        >\n                            <Descriptions.Item label=\"比赛时长\">\n                                {data.duration / 60000} 分钟\n                            </Descriptions.Item>\n                            <Descriptions.Item label=\"封榜时刻\">\n                                {data.freezeTime / 60000}  分钟\n                            </Descriptions.Item>\n                            <Descriptions.Item label=\"罚时单位\">\n                                {data.penaltyTime / 60000} 分钟\n                            </Descriptions.Item>\n                            <Descriptions.Item label=\"题目数量\">\n                                {data.problems.length}\n                            </Descriptions.Item>\n                            <Descriptions.Item label=\"队伍数量\">\n                                {data.teams.length}\n                            </Descriptions.Item>\n                            <Descriptions.Item label=\"提交数量\">\n                                {data.submissions.length}\n                            </Descriptions.Item>\n                            <Descriptions.Item label=\"题目颜色\" span={3}>\n                                <Space style={{\n                                    display: \"inline-flex\",\n                                    flexWrap: \"wrap\"\n                                }}>\n                                    {data.problems.map(p => {\n                                        return (\n                                            <Tag\n                                                key={p.id}\n                                                style={{\n                                                    display: \"inline-flex\",\n                                                    alignItems: \"center\",\n                                                }}\n                                            >\n                                                <strong style={{ marginRight: \"0.5em\" }}>{p.tag}</strong>\n                                                <span\n                                                    style={{\n                                                        display: \"inline-block\",\n                                                        width: \"1em\",\n                                                        height: \"1em\",\n                                                        backgroundColor: p.color,\n                                                        borderRadius: \"50%\"\n                                                    }}\n                                                />\n                                            </Tag>\n                                        );\n                                    })}\n                                </Space>\n                            </Descriptions.Item>\n                        </Descriptions>\n                    </Row>\n                    <Row>\n                        <Form form={form} style={{ width: \"100%\" }} layout=\"inline\"\n                            initialValues={{ autoReveal: false, shiningBeforeReveal: true, speedFactor: 1, showMedal: true }}\n                        >\n                            <Form.Item name=\"autoReveal\" label=\"自动运行\" valuePropName=\"checked\">\n                                <Switch />\n                            </Form.Item>\n                            <Form.Item name=\"shiningBeforeReveal\" label=\"题目闪烁动画\" valuePropName=\"checked\">\n                                <Switch />\n                            </Form.Item>\n                            <Form.Item name=\"speedFactor\" label=\"速度因子\">\n                                <InputNumber min={0.1} max={10} step={0.1} />\n                            </Form.Item>\n                            {data.medal === undefined ? null : (\n                                <Form.Item name=\"showMedal\" label=\"显示奖牌\" valuePropName=\"checked\">\n                                    <Switch />\n                                </Form.Item>\n                            )}\n                        </Form>\n                    </Row>\n                    <Row justify=\"center\" style={{ marginTop: \"1em\" }}>\n                        <Col span={6} style={{ display: \"flex\", justifyContent: \"center\" }}>\n                            <Button\n                                icon={<PlayCircleOutlined />}\n                                onClick={handleStart}\n                                style={{ width: \"100%\" }}\n                            >\n                                开始\n                            </Button>\n                        </Col>\n                    </Row>\n                </>\n            )}\n        </Card>\n    );\n};\n\nexport default Loader;\n","import * as dto from \"./dto\";\n\nexport interface TeamState {\n    info: dto.Team;\n    rank: number;\n    solved: number;\n    penalty: number;\n    problemStates: ProblemState[]\n}\n\nexport interface ProblemState {\n    info: dto.Problem;\n    revealedSubmissions: dto.Submission[];\n    unrevealedSubmissions: dto.Submission[];\n    state: ProblemStateKind;\n    tryCount: number;\n    acceptTime: number | null;\n}\n\nexport enum ProblemStateKind {\n    Passed,\n    Failed,\n    Pending,\n    Untouched,\n}\n\nexport interface ContestState {\n    teamStates: TeamState[]\n    info: dto.Contest;\n    cursor: { \n        index: number, \n        tick: number, \n        focus: number \n    };\n}\n\nexport function calcContestState(data: dto.Contest): ContestState {\n    const teamMap: Map<string, TeamState> = new Map<string, TeamState>();\n    data.teams.forEach(contestant => {\n        teamMap.set(\n            contestant.id,\n            {\n                info: contestant,\n                rank: 0,\n                solved: 0,\n                penalty: 0,\n                problemStates: data.problems.map(problem => ({\n                    info: problem,\n                    revealedSubmissions: [],\n                    unrevealedSubmissions: [],\n                    state: ProblemStateKind.Untouched,\n                    tryCount: 0,\n                    acceptTime: null,\n                }))\n            });\n    });\n\n    data.submissions.sort((lhs, rhs) => lhs.submitTime - rhs.submitTime);\n\n    data.submissions.forEach(submission => {\n        const team = teamMap.get(submission.teamId);\n        if (!team) {\n            throw new Error(\"invalid data\");\n        }\n        const p = team.problemStates.find(p => p.info.id === submission.problemId);\n        if (!p) {\n            throw new Error(\"invalid data\");\n        }\n        if (p.state === ProblemStateKind.Passed) {\n            return;\n        }\n        if (submission.submitTime < data.freezeTime) {\n            p.revealedSubmissions.push(submission);\n            p.tryCount += 1;\n            if (submission.accepted) {\n                p.state = ProblemStateKind.Passed;\n                p.acceptTime = submission.submitTime;\n                team.solved += 1;\n                team.penalty += Math.floor(p.acceptTime / 60000) * 60000 + data.penaltyTime * (p.tryCount - 1);\n            } else {\n                p.state = ProblemStateKind.Failed;\n            }\n        } else {\n            p.unrevealedSubmissions.push(submission);\n            p.tryCount += 1;\n            p.state = ProblemStateKind.Pending;\n        }\n    });\n\n    const teamStates = Array.from(teamMap.entries()).map((e) => e[1]);\n    const state = {\n        teamStates,\n        info: data,\n        cursor: {\n            index: teamStates.length - 1,\n            tick: 0,\n            focus: teamStates.length - 1\n        }\n    };\n    calcRankInplace(state);\n    return state;\n}\n\nexport function calcRankInplace(state: ContestState): void {\n    state.teamStates.sort((lhs, rhs) => {\n        if (lhs.solved !== rhs.solved) {\n            return -(lhs.solved - rhs.solved);\n        }\n        if (lhs.penalty !== rhs.penalty) {\n            return (lhs.penalty - rhs.penalty);\n        }\n        if (lhs.info.name !== rhs.info.name) {\n            return lhs.info.name < rhs.info.name ? (-1) : (1);\n        }\n        return 0;\n    });\n\n    let last_solved = 0;\n    let last_penalty = 0;\n    let last_rank = 0;\n    state.teamStates.forEach((team, idx) => {\n        if (team.solved < last_solved || team.penalty > last_penalty) {\n            last_rank = idx + 1;\n        }\n        team.rank = last_rank;\n        last_solved = team.solved;\n        last_penalty = team.penalty;\n    });\n}\n\nexport type HighlightItem = {\n    teamId: string;\n    problemId: string;\n    accepted: boolean;\n}\n\nexport type RevealGen = Generator<HighlightItem | undefined, void, void>;\n\nexport function* reveal(state: ContestState): Generator<HighlightItem | undefined, void, void> {\n    let checked = true;\n    while (state.cursor.index >= 0) {\n        state.cursor.focus = state.cursor.index;\n        const team = state.teamStates[state.cursor.index];\n        const p = team.problemStates.find(p => p.state === ProblemStateKind.Pending);\n        if (p) {\n            if (!checked) {\n                state.cursor.tick += 1;\n                yield;\n            }\n\n            const isAccepted = p.unrevealedSubmissions.some((s) => s.accepted);\n            state.cursor.tick += 1;\n            yield {\n                teamId: team.info.id,\n                problemId: p.info.id,\n                accepted: isAccepted\n            };\n            if (isAccepted) {\n                p.state = ProblemStateKind.Passed;\n                const idx = p.unrevealedSubmissions.findIndex(s => s.accepted);\n                p.tryCount = p.tryCount - p.unrevealedSubmissions.length + idx + 1;\n                p.acceptTime = p.unrevealedSubmissions[idx].submitTime;\n                team.solved += 1;\n                team.penalty += Math.floor(p.acceptTime / 60000) * 60000 + state.info.penaltyTime * (p.tryCount - 1);\n            } else {\n                p.state = ProblemStateKind.Failed;\n            }\n            p.revealedSubmissions.push(...p.unrevealedSubmissions);\n            p.unrevealedSubmissions = [];\n            yield;\n            const prevRank = team.rank;\n            calcRankInplace(state);\n            const curRank = team.rank;\n            console.log(`team \"${team.info.name}\" rank ${prevRank} -> ${curRank}`);\n            state.cursor.focus = state.teamStates.findIndex(t => Object.is(t, team));\n            state.cursor.tick += 1;\n            yield;\n            checked = true;\n        }\n        else {\n            if (!checked) {\n                console.log(\"yield at cursor index = \", state.cursor.index);\n                state.cursor.tick += 1;\n                yield;\n            }\n            state.cursor.index -= 1;\n            checked = false;\n        }\n    }\n    state.cursor.focus = -1;\n}\n\nexport interface BoardOptions {\n    autoReveal: boolean;\n    shiningBeforeReveal: boolean;\n    speedFactor: number;\n    showMedal: boolean;\n}","import \"./Board.css\";\n\nimport * as dto from \"./dto\";\nimport * as vo from \"./vo\";\nimport * as util from \"./util\";\n\nimport React, { useState, useEffect, useCallback, useRef, useMemo, CSSProperties } from \"react\";\nimport FlipMove from \"react-flip-move\";\nimport { StickyContainer, Sticky } from \"react-sticky\";\nimport { Transition } from \"react-transition-group\";\nimport { Tooltip } from \"antd\";\n\nfunction cvtColor(state: vo.ProblemStateKind): string | undefined {\n    if (state === vo.ProblemStateKind.Passed) {\n        return \"green\";\n    }\n    if (state === vo.ProblemStateKind.Failed) {\n        return \"red\";\n    }\n    if (state === vo.ProblemStateKind.Pending) {\n        return \"orange\";\n    }\n    return undefined;\n}\n\ninterface BoardProps {\n    data: dto.Contest;\n    options: vo.BoardOptions;\n}\n\nconst Board: React.FC<BoardProps> = ({ data, options }: BoardProps) => {\n\n    const [state, setState] = useState<vo.ContestState>(useMemo(() => vo.calcContestState(data), [data]));\n\n    const [highlightItem, setHighlightItem] = useState<vo.HighlightItem | null>(null);\n\n    const revealGen = useRef<vo.RevealGen>(vo.reveal(state));\n\n    const highlightNodeRef = useRef<HTMLSpanElement | null>(null);\n\n    const [highlightFlag, setHighlightFlag] = useState<boolean>(false);\n\n    const [keyLock, setKeyLock] = useState<boolean>(false);\n\n    const [autoReveal, setAutoReveal] = useState<boolean>(options.autoReveal);\n    const [speedFactor, setSpeedFactor] = useState<number>(options.speedFactor);\n\n    const [focusIndex, setFocusIndex] = useState<number>(state.cursor.focus);\n\n    const handleNextStep = useCallback(() => {\n        console.log(new Date().getTime(), \"handleNextStep\");\n        const prevCursorIdx = state.cursor.index;\n        const item = revealGen.current.next();\n        setFocusIndex(state.cursor.focus);\n        if (state.cursor.index !== prevCursorIdx && state.cursor.index >= 0) {\n            const team = state.teamStates[state.cursor.index];\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            const element = document.querySelector<HTMLTableRowElement>(`#team-id-${team.info.id}`)!;\n            const rect = element.getBoundingClientRect();\n            window.scrollTo({ left: 0, top: window.scrollY + rect.top - window.innerHeight / 2, behavior: \"smooth\" });\n        }\n        console.log(\"cursor index = \", state.cursor.index);\n        if (!item.done) {\n            if (item.value) {\n                const value = item.value;\n                void (async (): Promise<void> => {\n                    console.log(\"reveal highlight\");\n                    setKeyLock(true);\n                    console.log(\"locked\");\n                    setHighlightItem(value);\n\n                    let delay;\n                    delay = options.shiningBeforeReveal ? 1200 : (autoReveal ? 400 : 0);\n                    console.log(\"delay\", delay / speedFactor);\n                    await util.delay(delay / speedFactor);  // wait for shining\n                    handleNextStep();\n\n                    delay = autoReveal ? (value.accepted ? 800 : 300) : (0);\n                    console.log(\"delay\", delay / speedFactor);\n                    await util.delay(delay / speedFactor); // wait for showing result\n\n                    const team = state.teamStates.find(t => t.info.id === value.teamId);\n                    const prevRank = team?.rank;\n                    handleNextStep();\n                    const curRank = team?.rank;\n\n                    if (prevRank !== curRank) {\n                        delay = 2000;\n                        console.log(\"delay\", delay / speedFactor);\n                        await util.delay(delay / speedFactor); // wait for moving up\n                    }\n\n                    setKeyLock(false);\n                    console.log(\"unlocked\");\n                })();\n            } else {\n                setHighlightItem(null);\n            }\n        } else {\n            setHighlightItem(null);\n        }\n        setState({ ...state });\n        return item.done;\n    }, [state, speedFactor, options.shiningBeforeReveal, autoReveal]);\n\n    // useEffect(() => {\n    //     if (state.cursor.tick === 0) {\n    //         const team = state.teamStates[state.cursor.index];\n    //         // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n    //         const element = document.querySelector<HTMLTableRowElement>(`#team-id-${team.info.id}`)!;\n    //         const dis = element.getBoundingClientRect().top + window.scrollY;\n    //         const dur = 10;\n    //         let count = 0;\n    //         const frame = () => {\n    //             window.scrollBy({ left: 0, top: dis / dur / 60, behavior: \"auto\" });\n    //             count += 1;\n    //             if (count < dur * 60) {\n    //                 window.requestAnimationFrame(frame);\n    //             } else {\n    //                 setKeyLock(false);\n    //             }\n    //         };\n    //         setKeyLock(true);\n    //         setTimeout(() => {\n    //             window.requestAnimationFrame(frame);\n    //         }, 2000);\n    //     }\n    // }, [state]);\n\n    useEffect(() => {\n        if (state.cursor.tick === 0) {\n            const team = state.teamStates[state.cursor.index];\n            // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n            const element = document.querySelector<HTMLTableRowElement>(`#team-id-${team.info.id}`)!;\n            element.scrollIntoView({ behavior: \"smooth\" });\n        }\n    }, [state]);\n\n    const handleKeydown = useCallback((e: KeyboardEvent) => {\n        console.log(\"keydown\", e.key);\n        if (e.key === \"Enter\") {\n            if (state.cursor.index < 0) {\n                return;\n            }\n            if (keyLock) {\n                return;\n            }\n            handleNextStep();\n        }\n        if (e.key === \"p\") {\n            setAutoReveal(a => {\n                if (a) {\n                    console.log(\"disable autoReveal\");\n                } else {\n                    console.log(\"enable autoReveal\");\n                }\n                return !a;\n            });\n        }\n        if (e.key === \"+\") {\n            const s = speedFactor + 0.1;\n            if (s > 10) { return; }\n            setSpeedFactor(s);\n            console.log(\"speedFactor\", s);\n        }\n        if (e.key === \"-\") {\n            const s = speedFactor - 0.1;\n            if (s < 0.1) { return; }\n            setSpeedFactor(s);\n            console.log(\"speedFactor\", s);\n        }\n    }, [handleNextStep, keyLock, speedFactor, state.cursor]);\n\n    useEffect(() => {\n        document.addEventListener(\"keydown\", handleKeydown);\n        return () => document.removeEventListener(\"keydown\", handleKeydown);\n    }, [handleKeydown]);\n\n    const handleClick = useCallback(() => {\n        if (state.cursor.index < 0) {\n            return;\n        }\n        if (keyLock) { return; }\n        console.log(\"click\");\n        handleNextStep();\n    }, [handleNextStep, keyLock, state.cursor]);\n\n    useEffect(() => {\n        document.addEventListener(\"click\", handleClick);\n        return () => document.removeEventListener(\"click\", handleClick);\n    }, [handleClick]);\n\n    useEffect(() => {\n        if (state.cursor.tick !== 0 && autoReveal && state.cursor.index >= 0) {\n            const timer = setInterval(() => {\n                if (keyLock) { return; }\n                const done = handleNextStep();\n                if (done) { clearInterval(timer); }\n            }, 500 / speedFactor);\n            return () => clearInterval(timer);\n        }\n    }, [state, keyLock, handleNextStep, autoReveal, speedFactor]);\n\n    useEffect(() => {\n        if (highlightItem && options.shiningBeforeReveal) {\n            setHighlightFlag(f => !f);\n            const timer = setInterval(() => {\n                setHighlightFlag(f => {\n                    console.log(\"flag\", !f);\n                    return !f;\n                });\n            }, 400 / speedFactor);\n            return () => clearInterval(timer);\n        }\n    }, [highlightItem, options, speedFactor]);\n\n    const [windowWidth, setWindowWidth] = useState<number>(window.innerWidth);\n\n    useEffect(() => {\n        const handleResize = () => setWindowWidth(window.innerWidth);\n        window.onresize = handleResize;\n        return () => { window.onresize = null; };\n    }, []);\n\n    const handleMovingFinished = useCallback(() => {\n        setFocusIndex(state.cursor.index);\n    }, [state.cursor]);\n\n    return (\n        <StickyContainer style={{ width: \"100%\" }}>\n            <Sticky>\n                {({ style }) => (\n                    <table\n                        style={{\n                            width: \"100%\",\n                            fontSize: \"2em\",\n                            textAlign: \"center\",\n                            backgroundColor: \"white\",\n                            zIndex: 1024,\n                            boxShadow: \"0 5px 8px 4px rgba(0, 0, 0, 0.09)\",\n                            ...style\n                        }}\n                    >\n                        <thead>\n                            <tr>\n                                <th style={{ width: \"5%\" }}>\n                                    <span\n                                        style={{\n                                            position: \"absolute\", zIndex: 2048, top: 0, left: 0,\n                                            borderRadius: \"50%\", width: \"6px\", height: \"6px\",\n                                            backgroundColor: keyLock ? \"#ff4d4f\" : \"#52c41a\"\n                                        }}\n                                    />\n                                    Rank\n                                </th>\n                                <th style={{ width: \"20%\" }}>\n                                    Team\n                                </th>\n                                <th style={{ width: \"10%\" }}>\n                                    Score\n                                </th>\n                                {data.problems.map(p => (\n                                    <th\n                                        key={p.id}\n                                        style={{\n                                            width: `${65 / data.problems.length}%`,\n                                        }}\n                                    >\n                                        <span\n                                            style={{\n                                                display: \"inline-flex\",\n                                                alignItems: \"center\"\n                                            }}\n                                        >\n                                            <strong style={{ marginRight: \"0.5em\" }}>{p.tag}</strong>\n                                            <span\n                                                style={{\n                                                    display: \"inline-block\",\n                                                    width: \"1em\",\n                                                    height: \"1em\",\n                                                    backgroundColor: p.color,\n                                                    borderRadius: \"50%\"\n                                                }}\n                                            />\n                                        </span>\n                                    </th>\n                                ))}\n                            </tr>\n                        </thead>\n                    </table>\n                )}\n            </Sticky>\n\n            <FlipMove\n                style={{\n                    width: \"100%\",\n                    overflowAnchor: \"none\",\n                    fontSize: \"2em\",\n                    textAlign: \"center\",\n                    transformStyle: \"preserve-3d\"\n                }}\n                duration={2000 / speedFactor}\n                onFinish={handleMovingFinished}\n            >\n\n                {state.teamStates.map((team, idx) => {\n                    const isFocused = idx === focusIndex;\n\n                    let backgroundColor = \"white\";\n                    if (state.info.medal && options.showMedal) {\n                        const goldLine = state.info.medal.gold;\n                        const silverLine = goldLine + state.info.medal.silver;\n                        const bronzeLine = silverLine + state.info.medal.bronze;\n                        if (idx < goldLine) {\n                            backgroundColor = \"#fff9c0\";\n                        } else if (idx < silverLine) {\n                            backgroundColor = \"#f6f6f6\";\n                        } else if (idx < bronzeLine) {\n                            backgroundColor = \"#eddccf\";\n                        }\n                    }\n\n                    return (\n                        <table\n                            key={team.info.id}\n                            id={`team-id-${team.info.id}`}\n                            className={(isFocused ? \"focused-team\" : \"team\")}\n                            style={{ transformStyle: \"preserve-3d\" }}\n                        >\n                            <tbody>\n                                <tr\n                                    style={{\n                                        transform: isFocused ? \"perspective(65535px) translateZ(1px)\" : undefined,\n                                        backgroundColor\n                                    }}\n                                >\n                                    <td style={{ width: \"5%\" }}>\n                                        {team.rank}\n                                    </td>\n                                    <Tooltip title={team.info.name}>\n                                        <td\n                                            style={{\n                                                maxWidth: `${windowWidth * 0.20}px`,\n                                                width: \"20%\",\n                                                whiteSpace: \"nowrap\",\n                                                overflow: \"hidden\",\n                                                textOverflow: \"ellipsis\"\n                                            }}\n                                        >\n                                            {team.info.name}\n                                        </td>\n                                    </Tooltip>\n                                    <td style={{ width: \"10%\" }}>\n                                        {`${team.solved} - ${Math.floor(team.penalty / 60000)}`}\n                                    </td>\n                                    {team.problemStates.map((p) => {\n                                        const isHighlighted = highlightItem\n                                            && highlightItem.teamId === team.info.id\n                                            && highlightItem.problemId === p.info.id;\n\n                                        const text = p.state === vo.ProblemStateKind.Untouched ? (undefined) : (\n                                            p.state === vo.ProblemStateKind.Passed ?\n                                                `${p.tryCount} - ${Math.floor((p.acceptTime ?? 0) / 60000)}`\n                                                : `${p.tryCount}`\n                                        );\n\n                                        const duration = 400 / speedFactor;\n\n                                        const grid = (style: CSSProperties) => (\n                                            <span\n                                                style={{\n                                                    display: \"inline-block\",\n                                                    maxWidth: \"4em\",\n                                                    width: \"100%\",\n                                                    minHeight: \"1em\",\n                                                    borderRadius: \"0.25em\",\n                                                    backgroundColor: cvtColor(p.state),\n                                                    color: \"white\",\n                                                    transition: `opacity ${duration}ms ease-in-out`,\n                                                    opacity: 1,\n                                                    ...style\n                                                }}\n                                                ref={isHighlighted ? highlightNodeRef : null}\n                                            >\n                                                {text}\n                                            </span>\n                                        );\n\n                                        const transitionStyles = {\n                                            entering: { opacity: 0 },\n                                            entered: { opacity: 0 },\n                                            exiting: { opacity: 1 },\n                                            exited: { opacity: 1 },\n                                            unmounted: {}\n                                        };\n\n                                        const wrappedGrid = isHighlighted ? (\n                                            <Transition\n                                                in={highlightFlag}\n                                                timeout={duration}\n                                                nodeRef={highlightNodeRef}\n                                            >\n                                                {(state) => grid(transitionStyles[state])}\n                                            </Transition>\n                                        ) : grid({});\n\n                                        return (\n                                            <td key={p.info.id} style={{ width: `${65 / team.problemStates.length}%` }}>\n                                                {wrappedGrid}\n                                            </td>\n                                        );\n                                    })}\n                                </tr>\n                            </tbody>\n                        </table>\n                    );\n                })}\n            </FlipMove>\n        </StickyContainer>\n    );\n};\n\nexport default Board;","import \"antd/dist/antd.css\";\nimport \"./App.css\";\n\nimport * as dto from \"./dto\";\nimport * as vo from \"./vo\";\nimport Loader from \"./Loader\";\n\nimport React, { useState, useCallback, } from \"react\";\nimport { Row, Col, } from \"antd\";\nimport Board from \"./Board\";\n\nconst App: React.FC = () => {\n    const [data, setData] = useState<dto.Contest | null>(null);\n    const [options, setOptions] = useState<vo.BoardOptions | null>(null);\n\n    const [running, setRunning] = useState(false);\n\n    const handleStart = useCallback((options) => {\n        setRunning(true);\n        setOptions(options);\n        console.debug(data, options);\n    }, [data]);\n\n    const handleLoad = useCallback((data) => setData(data), []);\n\n    return (\n        <>\n            {!running ? (\n                <Row justify=\"center\" style={{ marginTop: \"0em\", alignItems: \"center\", minHeight: \"80vh\" }}>\n                    <Col span={24} lg={16}>\n                        <Loader onLoad={handleLoad} onStart={handleStart} />\n                    </Col>\n                </Row>\n            ) : null}\n            {(data !== null && running) ? (\n                <>\n                    <Row justify=\"center\" style={{ width: \"calc(100vw - 4px)\" }}>\n                        {/* eslint-disable-next-line @typescript-eslint/no-non-null-assertion */}\n                        <Board data={data} options={options!} />\n                    </Row>\n                    <div style={{ minHeight: \"50vh\" }}></div>\n                </>\n            ) : null}\n        </>\n    );\n};\n\nexport default App;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport * as serviceWorker from \"./serviceWorker\";\n\nimport App from \"./app/App\";\n\nReactDOM.render(\n    // <React.StrictMode>\n    <App />,\n    // </React.StrictMode>,\n    document.getElementById(\"root\")\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}