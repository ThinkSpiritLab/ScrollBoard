(this["webpackJsonpscroll-board"]=this["webpackJsonpscroll-board"]||[]).push([[0],{136:function(e,t,n){e.exports=n(264)},142:function(e,t,n){},257:function(e,t,n){},264:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(8),i=n.n(o);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var c=n(22),l=(n(141),n(142),n(27)),s=n.n(l),u=n(56);function d(e){return new Promise((function(t,n){var a=new FileReader;a.onload=function(e){var n,a,r;t(null!==(n=null===(a=e.target)||void 0===a||null===(r=a.result)||void 0===r?void 0:r.toString())&&void 0!==n?n:"")},a.onerror=function(e){return n(e)},a.readAsText(e)}))}function m(e){return new Promise((function(t){setTimeout((function(){return t()}),e)}))}function f(e,t){var n=setInterval(t,e);return{stop:function(){clearInterval(n)}}}var p,b=n(133),v=n(80),h=s.a.mark(x);function g(e,t){var n=0;return"icpc"===e&&t.accepted&&(n=1),"ioi"===e&&void 0!==t.score&&(n=t.score),n}function y(e){e.teamStates.sort((function(e,t){if(e.score!==t.score)return-(e.score-t.score);if(e.penalty!==t.penalty)return e.penalty-t.penalty;var n=parseInt(e.info.id),a=parseInt(t.info.id);return n!==a?n<a?-1:1:0}));var t=0,n=0,a=1;e.teamStates.forEach((function(e,r){e.info.wildcard?e.rank=a:((e.score<t||e.penalty>n)&&(a=r+1),e.rank=a,t=e.score,n=e.penalty)}))}function x(e){var t,n,a;return s.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=null!==(t=e.info.rule)&&void 0!==t?t:"icpc",a=s.a.mark((function t(){var a,r,o,i,l,u,d,m,f,v;return s.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.cursor.focus=e.cursor.index,a=e.teamStates[e.cursor.index],!(r=a.problemStates.find((function(e){return e.state===p.Pending})))){t.next=31;break}if(i=E(n,r)){t.next=7;break}throw new Error("logic error");case 7:return l=Object(c.a)(i,2),u=l[0],d=l[1],m=g(n,d),e.cursor.tick+=1,t.next=12,{teamId:a.info.id,problemId:r.info.id,passed:m>r.highestScore};case 12:return m>r.highestScore&&(null!==r.passIndex&&null!==r.passTime&&(a.score-=r.highestScore,a.penalty-=r.passTime+6e4*e.info.penaltyTime*r.passIndex),r.highestScore=m,r.passIndex=u,r.passTime=d.submitTime,a.score+=r.highestScore,a.penalty+=r.passTime+6e4*e.info.penaltyTime*r.passIndex),r.state=r.highestScore>0?p.Passed:p.Failed,void 0===e.firstSolvers[r.info.id]&&d.accepted&&(e.firstSolvers[r.info.id]=a.info.id),r.state===p.Failed&&(r.tryCount+=r.unrevealedSubmissions.length),r.unrevealedSubmissions=[],(o=r.revealedSubmissions).push.apply(o,Object(b.a)(r.unrevealedSubmissions)),e.cursor.tick+=1,void(t.next=21);case 21:return f=a.rank,y(e),v=a.rank,console.log('team "'.concat(a.info.name,'" rank ').concat(f," -> ").concat(v)),e.cursor.focus=e.teamStates.findIndex((function(e){return Object.is(e,a)})),e.cursor.tick+=1,void(t.next=29);case 29:t.next=36;break;case 31:if(e.cursor.index===e.teamStates.length-1){t.next=35;break}return e.cursor.tick+=1,void(t.next=35);case 35:e.cursor.index-=1;case 36:case"end":return t.stop()}}),t)}));case 2:if(!(e.cursor.index>=0)){r.next=6;break}return r.delegateYield(a(),"t0",4);case 4:r.next=2;break;case 6:e.cursor.focus=-1;case 7:case"end":return r.stop()}}),h)}function E(e,t){var n,a=null,r=0,o=Object(v.a)(t.unrevealedSubmissions);try{for(o.s();!(n=o.n()).done;){var i=n.value,c=g(e,i[1]);null===a?(a=i,r=c):c>r&&(a=i)}}catch(l){o.e(l)}finally{o.f()}return a}!function(e){e[e.Untouched=0]="Untouched",e[e.Pending=1]="Pending",e[e.Passed=2]="Passed",e[e.Failed=3]="Failed"}(p||(p={}));var k=n(269),w=n(270),S=n(53),j=n(273),O=n(267),I=n(275),T=n(276),F=n(268),R=n(277),C=n(278),M=n(33),P=n(279),N=n(280),B=n(118);function V(){var e=B.parse(window.location.search)["data-url"];return"string"===typeof e?e:void 0}var z=function(e){var t=e.onLoad,n=e.onStart,o=Object(a.useState)(),i=Object(c.a)(o,2),l=i[0],m=i[1],f=Object(a.useRef)(null),p=Object(a.useState)(null),b=Object(c.a)(p,2),v=b[0],h=b[1],g=function(){var e=Object(u.a)(s.a.mark((function e(n){var a,r,o,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r=null===(a=n.currentTarget.files)||void 0===a?void 0:a.item(0))){e.next=10;break}return e.next=4,d(r);case 4:o=e.sent,(i=JSON.parse(o)).problems.sort((function(e,t){return e.tag!==t.tag?e.tag<t.tag?-1:1:0})),m(r.name),h(i),t(i);case 10:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){(function(){var e=Object(u.a)(s.a.mark((function e(){var n,a,r;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(n=V())){e.next=11;break}return e.next=4,fetch(n);case 4:return a=e.sent,e.next=7,a.json();case 7:r=e.sent,m(n),h(r),t(r);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}})()().catch((function(e){return console.error(e)}))}),[t]);var y=k.a.useForm(),x=Object(c.a)(y,1)[0],E=Object(a.useCallback)((function(){var e=!!x.getFieldValue("autoReveal"),t=!!x.getFieldValue("shiningBeforeReveal"),a=parseFloat(x.getFieldValue("speedFactor")),r=void 0!==(null===v||void 0===v?void 0:v.medal)&&!!x.getFieldValue("showMedal"),o=!!x.getFieldValue("darkMode");n({autoReveal:e,shiningBeforeReveal:t,speedFactor:a,showMedal:r,darkMode:o})}),[n,x,v]);return r.a.createElement(w.a,{style:{borderColor:"transparent",boxShadow:"0 1px 2px -2px rgba(0, 0, 0, 0.16), 0 3px 6px 0 rgba(0, 0, 0, 0.12), 0 5px 12px 4px rgba(0, 0, 0, 0.09)"}},r.a.createElement("input",{type:"file",style:{display:"none"},multiple:!1,ref:f,onChange:g}),r.a.createElement(S.a,{justify:"center",style:{alignItems:"baseline"}},l?r.a.createElement("span",{style:{flexGrow:1,textAlign:"center",margin:"0 1em"}},l):null,r.a.createElement(j.a,{icon:r.a.createElement(P.a,null),onClick:function(){var e;return null===(e=f.current)||void 0===e?void 0:e.click()}},"\u52a0\u8f7d\u6570\u636e")),null===v?null:r.a.createElement(r.a.Fragment,null,r.a.createElement(O.a,{style:{margin:"1em 0"}}),r.a.createElement(S.a,{style:{marginTop:"1em"}},r.a.createElement(I.a,{column:{xs:1,lg:3},title:r.a.createElement("span",{style:{display:"inline-block",width:"100%",textAlign:"center",fontSize:"1.5em"}},v.name)},r.a.createElement(I.a.Item,{label:"\u6bd4\u8d5b\u65f6\u957f"},v.duration/6e4," \u5206\u949f"),r.a.createElement(I.a.Item,{label:"\u5c01\u699c\u65f6\u523b"},r.a.createElement(T.a,{defaultValue:v.freezeTime/6e4,formatter:function(e){return"".concat(String(e))},onChange:function(e){return v.freezeTime=6e4*Number(e)},step:10}),"\u5206\u949f"),r.a.createElement(I.a.Item,{label:"\u7f5a\u65f6\u5355\u4f4d"},v.penaltyTime," \u5206\u949f"),r.a.createElement(I.a.Item,{label:"\u9898\u76ee\u6570\u91cf"},v.problems.length),r.a.createElement(I.a.Item,{label:"\u961f\u4f0d\u6570\u91cf"},v.teams.length),r.a.createElement(I.a.Item,{label:"\u63d0\u4ea4\u6570\u91cf"},v.submissions.length),r.a.createElement(I.a.Item,{label:"\u9898\u76ee\u989c\u8272",span:3},r.a.createElement(F.a,{style:{display:"inline-flex",flexWrap:"wrap"}},v.problems.map((function(e){return r.a.createElement(R.a,{key:e.id,style:{display:"inline-flex",alignItems:"center"}},r.a.createElement("strong",{style:{marginRight:"0.5em"}},e.tag),r.a.createElement("span",{style:{display:"inline-block",width:"1em",height:"1em",backgroundColor:e.color,borderRadius:"50%"}}))})))))),r.a.createElement(S.a,null,r.a.createElement(k.a,{form:x,style:{width:"100%"},layout:"inline",initialValues:{autoReveal:!1,shiningBeforeReveal:!0,speedFactor:2,showMedal:!0}},r.a.createElement(k.a.Item,{name:"autoReveal",label:"\u81ea\u52a8\u8fd0\u884c",valuePropName:"checked"},r.a.createElement(C.a,null)),r.a.createElement(k.a.Item,{name:"shiningBeforeReveal",label:"\u9898\u76ee\u95ea\u70c1\u52a8\u753b",valuePropName:"checked"},r.a.createElement(C.a,null)),r.a.createElement(k.a.Item,{name:"speedFactor",label:"\u901f\u5ea6\u56e0\u5b50"},r.a.createElement(T.a,{min:.1,max:10,step:.1})),r.a.createElement(k.a.Item,{name:"darkMode",label:"\u9ed1\u6697\u6a21\u5f0f",valuePropName:"checked"},r.a.createElement(C.a,null)))),r.a.createElement(S.a,{justify:"center",style:{marginTop:"1em"}},r.a.createElement(M.a,{span:6,style:{display:"flex",justifyContent:"center"}},r.a.createElement(j.a,{icon:r.a.createElement(N.a,null),onClick:E,style:{width:"100%"}},"\u5f00\u59cb")))))},W=n(97);n(257);function A(e,t){Object(a.useEffect)((function(){return document.addEventListener(e,t),function(){return document.removeEventListener(e,t)}}),[e,t])}var H=n(131),L=n(94),U=n(274),J=n(271),q=n(272),Y=n(281);function D(e){J.b.info({content:e,className:"info-message",duration:.4})}var G=function(e){var t=e.data,n=e.options,o=Object(a.useState)(Object(a.useMemo)((function(){return function(e){var t;e.submissions.sort((function(e,t){return e.submitTime-t.submitTime})),e.problems.sort((function(e,t){return e.tag!==t.tag?e.tag<t.tag?-1:1:0}));var n,a=new Map,r=Object(v.a)(e.teams);try{for(r.s();!(n=r.n()).done;){var o=n.value,i={info:o,problemStates:e.problems.map((function(e){return{info:e,revealedSubmissions:[],unrevealedSubmissions:[],state:p.Untouched,highestScore:0,passIndex:null,passTime:null,tryCount:0}})),rank:0,score:0,penalty:0};a.set(o.id,i)}}catch(b){r.e(b)}finally{r.f()}var c,l={},s=null!==(t=e.rule)&&void 0!==t?t:"icpc",u=Object(v.a)(e.submissions);try{var d=function(){var t=c.value,n=a.get(t.teamId);if(!n)return"continue";var r=n.problemStates.find((function(e){return e.info.id===t.problemId}));if(!r)throw new Error("invalid data");if("icpc"===s&&r.state===p.Passed)return"continue";var o=r.revealedSubmissions.length+r.unrevealedSubmissions.length;if(t.submitTime>=e.freezeTime)r.unrevealedSubmissions.push([o,t]),r.state=p.Pending;else{var i=g(s,t);i>r.highestScore&&(null!==r.passIndex&&null!==r.passTime&&(n.score-=r.highestScore,n.penalty-=r.passTime+6e4*e.penaltyTime*r.passIndex),r.highestScore=i,r.passIndex=o,r.passTime=t.submitTime,n.score+=r.highestScore,n.penalty+=r.passTime+6e4*e.penaltyTime*r.passIndex),r.revealedSubmissions.push([o,t]),r.state=r.highestScore>0?p.Passed:p.Failed,r.tryCount+=1,void 0===l[r.info.id]&&t.accepted&&(l[r.info.id]=n.info.id)}};for(u.s();!(c=u.n()).done;)d()}catch(b){u.e(b)}finally{u.f()}var m=Array.from(a.values()),f={info:e,teamStates:m,firstSolvers:l,cursor:{index:m.length-1,tick:0,focus:m.length-1}};return y(f),f}(t)}),[t])),i=Object(c.a)(o,2),l=i[0],d=i[1],b=Object(a.useState)(null),h=Object(c.a)(b,2),E=h[0],k=h[1],w=Object(a.useRef)(x(l)),S=Object(a.useRef)(null),j=Object(a.useState)(!1),O=Object(c.a)(j,2),I=O[0],T=O[1],F=Object(a.useState)(!1),R=Object(c.a)(F,2),C=R[0],M=R[1],P=Object(a.useState)(n.autoReveal),N=Object(c.a)(P,2),B=N[0],V=N[1],z=Object(a.useState)(n.speedFactor),J=Object(c.a)(z,2),G=J[0],Z=J[1],$=Object(a.useState)(l.cursor.focus),K=Object(c.a)($,2),Q=K[0],X=K[1],_=Object(a.useCallback)((function(){console.log((new Date).getTime(),"handleNextStep");var e=l.cursor.index,t=w.current.next();if(X(l.cursor.focus),l.cursor.index!==e&&l.cursor.index>=0){var a=l.teamStates[l.cursor.index],r=document.querySelector("#team-id-".concat(a.info.id)).getBoundingClientRect();window.scrollTo({left:0,top:window.scrollY+r.top-window.innerHeight/2,behavior:"smooth"})}if(console.log("cursor index = ",l.cursor.index),t.done)k(null);else if(t.value){var o=t.value;Object(u.a)(s.a.mark((function e(){var t,a,r,i;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("reveal highlight"),M(!0),console.log("locked"),k(o),t=n.shiningBeforeReveal?600:B?200:0,console.log("delay",t/G),e.next=8,m(t/G);case 8:return _(),t=B?o.passed?500:200:0,console.log("delay",t/G),e.next=13,m(t/G);case 13:if(a=l.teamStates.find((function(e){return e.info.id===o.teamId})),r=null===a||void 0===a?void 0:a.rank,_(),i=null===a||void 0===a?void 0:a.rank,r===i){e.next=22;break}return t=800,console.log("delay",t/G),e.next=22,m(t/G);case 22:M(!1),console.log("unlocked");case 24:case"end":return e.stop()}}),e)})))()}else k(null);return d(Object(W.a)({},l)),t.done}),[l,G,n.shiningBeforeReveal,B]);Object(a.useEffect)((function(){if(0===l.cursor.tick){var e=l.teamStates[l.cursor.index];document.querySelector("#team-id-".concat(e.info.id)).scrollIntoView({behavior:"smooth"})}}),[l]),A("keydown",Object(a.useCallback)((function(e){if(console.log("keydown",e.key),"Enter"===e.key){if(l.cursor.index<0)return;if(C)return;_()}if("p"===e.key&&(B?(console.log("disable autoReveal"),D("\u7981\u7528\u81ea\u52a8\u8fd0\u884c")):(console.log("enable autoReveal"),D("\u542f\u7528\u81ea\u52a8\u8fd0\u884c")),V((function(e){return!e}))),"+"===e.key){var t=Math.min(G+.5,10);Z(t),console.log("speedFactor",t),D("\u901f\u5ea6\u56e0\u5b50\uff1a".concat(t.toFixed(1)))}if("-"===e.key){var n=Math.max(G-.5,.1);Z(n),console.log("speedFactor",n),D("\u901f\u5ea6\u56e0\u5b50\uff1a".concat(n.toFixed(1)))}if("Control"===e.key){var a=G+3;a>10&&(a-=10),a<.1&&(a=.1),Z(a),console.log("speedFactor",a),D("\u901f\u5ea6\u56e0\u5b50\uff1a".concat(a.toFixed(1)))}}),[_,C,G,l.cursor,B])),A("click",Object(a.useCallback)((function(){l.cursor.index<0||C||(console.log("click"),_())}),[_,C,l.cursor])),Object(a.useEffect)((function(){if(0!==l.cursor.tick&&B&&l.cursor.index>=0){var e=f(500/G,(function(){C||_()&&e.stop()}));return function(){return e.stop()}}}),[l,C,_,B,G]),Object(a.useEffect)((function(){if(E&&n.shiningBeforeReveal){T((function(e){return!e}));var e=f(400/G,(function(){T((function(e){return console.log("flag",!e),!e}))}));return function(){return e.stop()}}}),[E,n,G]);var ee=function(){var e=Object(a.useState)(window.innerWidth),t=Object(c.a)(e,2),n=t[0],r=t[1];return Object(a.useEffect)((function(){return window.onresize=function(){return r(window.innerWidth)},function(){window.onresize=null}}),[]),{width:n}}().width,te=Object(a.useCallback)((function(){X(l.cursor.index)}),[l.cursor]);return r.a.createElement(L.StickyContainer,{style:{width:"100%",backgroundColor:n.darkMode?"#24292e":void 0}},r.a.createElement(L.Sticky,null,(function(e){var a=e.style;return r.a.createElement("table",{className:"board-head",style:a},r.a.createElement("thead",null,r.a.createElement("tr",{style:{backgroundColor:n.darkMode?"#24292e":"white",color:n.darkMode?"white":void 0}},r.a.createElement("th",{style:{width:"5%"}},r.a.createElement("span",{style:{position:"absolute",zIndex:2048,top:0,left:0,borderRadius:"50%",width:"6px",height:"6px",backgroundColor:C?"#ff4d4f":"#52c41a"}}),"Rank"),r.a.createElement("th",{style:{width:"20%"}},"Team"),r.a.createElement("th",{style:{width:"10%"}},"Score"),t.problems.map((function(e){return r.a.createElement("th",{key:e.id,style:{width:"".concat(65/t.problems.length,"%")}},r.a.createElement("span",{style:{display:"inline-flex",alignItems:"center"}},r.a.createElement("strong",{style:{marginRight:"0.5em"}},e.tag),r.a.createElement("span",{style:{display:"inline-block",width:"1em",height:"1em",backgroundColor:e.color,borderRadius:"50%"}})))})))))})),r.a.createElement(H.a,{className:"board-body",duration:800/G,onFinish:te},l.teamStates.map((function(e,t){var a=t===Q,o=n.darkMode?"white":void 0,i=n.darkMode?"0 5px 12px 4px rgba(255, 255, 255, 0.09), 0 -5px 12px 4px rgba(255, 255, 255, 0.09)":"0 5px 12px 4px rgba(0, 0, 0, 0.09), 0 -5px 12px 4px rgba(0, 0, 0, 0.09)",c=a?"1px solid transparent":"1px solid #f0f0f0",s=a?"1px solid #666666":"none";return r.a.createElement("table",{key:e.info.id,id:"team-id-".concat(e.info.id),className:a?"focused-team":"team",style:{border:n.darkMode?s:c,boxShadow:a?i:void 0,background:a?n.darkMode?"#24292e":"white":void 0}},r.a.createElement("tbody",null,r.a.createElement("tr",{style:{transform:a?"perspective(65535px) translateZ(1px)":void 0,color:o}},r.a.createElement("td",{style:{width:"5%"}},e.info.wildcard?"*".concat(e.rank):e.rank),r.a.createElement(q.a,{title:e.info.userName?"".concat(e.info.userName," - ").concat(e.info.name):"".concat(e.info.name)},r.a.createElement("td",{style:{maxWidth:"".concat(.2*ee,"px"),width:"20%",whiteSpace:"pre-wrap"}},void 0!==e.info.certifiedName&&e.info.certifiedName!==e.info.name?r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,e.info.name),r.a.createElement("div",null,e.info.certifiedName)):e.info.name,"female"===e.info.gender?r.a.createElement(Y.a,{style:{color:"pink"}}):void 0)),r.a.createElement("td",{style:{width:"10%"}},"".concat(e.score," - ").concat(Math.round(e.penalty/6e4))),e.problemStates.map((function(t){var n=E&&E.teamId===e.info.id&&E.problemId===t.info.id,a=function(){if(t.state!==p.Untouched){if(t.state===p.Passed){var e,n,a=Math.round((null!==(e=t.passTime)&&void 0!==e?e:0)/6e4)+(null!==(n=t.passIndex)&&void 0!==n?n:0)*l.info.penaltyTime;return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,t.highestScore),r.a.createElement("div",null,a))}return"".concat(t.tryCount)}}(),o=400/G,i=l.firstSolvers[t.info.id]===e.info.id?"#006600":function(e){if(e.state===p.Passed){var t=e.info.score;return void 0===t?"green":e.highestScore===t?"#33cc33":e.highestScore>.75*t?"#cccc00":e.highestScore>.6*t?"#cc9900":"#996600"}return e.state===p.Failed?"red":e.state===p.Pending?"#4343ff":void 0}(t),c=function(e){return r.a.createElement("span",{style:Object(W.a)({display:"inline-block",maxWidth:"4em",width:"100%",minHeight:"1em",borderRadius:"0.25em",backgroundColor:i,color:"white",transition:"opacity ".concat(o,"ms ease-in-out"),opacity:1},e),ref:n?S:null},a)},s={entering:{opacity:0},entered:{opacity:0},exiting:{opacity:1},exited:{opacity:1},unmounted:{}},u=n?r.a.createElement(U.a,{in:I,timeout:o,nodeRef:S},(function(e){return c(s[e])})):c({});return r.a.createElement("td",{key:t.info.id,style:{width:"".concat(65/e.problemStates.length,"%")}},u)})))))}))),r.a.createElement("div",{style:{minHeight:"50vh"}}))},Z=function(){var e=Object(a.useState)(null),t=Object(c.a)(e,2),n=t[0],o=t[1],i=Object(a.useState)(null),l=Object(c.a)(i,2),s=l[0],u=l[1],d=Object(a.useState)(!1),m=Object(c.a)(d,2),f=m[0],p=m[1],b=Object(a.useCallback)((function(e){p(!0),u(e),console.debug(n,e)}),[n]),v=Object(a.useCallback)((function(e){return o(e)}),[]);return r.a.createElement(r.a.Fragment,null,f?null:r.a.createElement(S.a,{justify:"center",style:{marginTop:"0em",alignItems:"center",minHeight:"80vh"}},r.a.createElement(M.a,{span:24,lg:16},r.a.createElement(z,{onLoad:v,onStart:b}))),null!==n&&f?r.a.createElement(r.a.Fragment,null,r.a.createElement(S.a,{justify:"center",style:{width:"calc(100vw - 4px)"}},r.a.createElement(G,{data:n,options:s}))):null)};i.a.render(r.a.createElement(Z,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[136,1,2]]]);
//# sourceMappingURL=main.e81aa2fe.chunk.js.map